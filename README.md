
## ⚙️ セットアップ方法 (ユーザー向け)

本マクロを使用するための準備手順は以下の通りです。

1.  **リポジトリの取得:**
    *   このGitHubリポジトリをローカルPCにクローンするか、ZIPファイルとしてダウンロードし、任意のフォルダに展開します。
2.  **マクロファイルの配置:**
    *   展開したフォルダ内の `src/schedule_extractor.xlsm` ファイルを、作業しやすい場所にコピーします。
3.  **Excelマクロの有効化:**
    *   `schedule_extractor.xlsm` ファイルを開きます。
    *   Excelのセキュリティ設定によっては、ファイルを開いた際に「セキュリティの警告 マクロが無効にされました」というメッセージバーが表示されます。その場合は「コンテンツの有効化」ボタンをクリックしてください。
    *   恒久的にマクロを信頼する場合は、Excelの「トラストセンター（セキュリティセンター）」の設定で、このファイルの保存場所を「信頼できる場所」として追加するか、マクロのセキュリティレベルを適切に調整してください（組織のポリシーに従ってください）。
4.  **「Config」シートの設定:**
    *   `schedule_extractor.xlsm` ファイル内の「Config」という名前のワークシートを開きます。
    *   このシートに、処理対象となる工程表ファイルの場所、抽出したいデータ項目の位置、適用するフィルター条件、各種出力シート名などを設定します。
    *   各設定項目の詳細な意味と設定方法については、同梱のドキュメント `docs/04_Config_Sheet_Definition.md` を必ず参照してください。
    *   特に重要な設定は、「処理対象ファイル/フォルダパスリスト」(`P557`-`P756`) と、それに対応する「各処理対象ファイル適用工程パターン識別子」(`Q557`-`Q756`) です。

## ▶️ 使用方法 (ユーザー向け)

1.  上記「セットアップ方法」に従い、マクロファイルを開き、「Config」シートに必要な設定を全て入力・確認します。
2.  マクロを実行します。（実行方法は、マクロファイル内に専用の実行ボタンが用意されているか、あるいは開発者から指示された特定の手順に従ってください。例：リボンの[開発]タブから[マクロ]を選択し、実行するマクロ名を選択して[実行]。）
3.  マクロの処理が開始されると、Excelのステータスバーに進捗状況が表示される場合があります（実装による）。
4.  処理が正常に完了すると、「処理が完了しました。抽出件数: X件、処理時間: Y.YY秒」といった内容のメッセージボックスが表示されます。
5.  「Config」シートの `O43` で指定された「抽出結果出力シート名」（例: `一覧データ`）に、抽出・集約されたデータが出力されていることを確認してください。
6.  必要に応じて、「Config」シートの `O44` で指定された「検索条件ログシート名」（例: `処理ログ`）および `O45` で指定された「エラーログシート名」（例: `エラー記録`）を参照し、実行内容や発生したエラー（もしあれば）を確認してください。

## 🛠️ 主な設定項目 (Configシートより抜粋)

「Config」シートでは、以下のカテゴリに関する詳細な設定が可能です。全項目の定義は `docs/04_Config_Sheet_Definition.md` を参照してください。

*   **デバッグモード:** マクロ開発者向けの高度なログ出力機能のON/OFF。
*   **基本シート名:** 抽出結果を出力するシート、処理ログシート、エラーログシートの名前を指定。
*   **工程表ファイルの基本構造:** 処理対象となる工程表ファイル内のシート名リスト、ヘッダーの行数・列数、1日分のデータが占める行数、1シートあたりの最大日数、年月日の情報が記載されているセルアドレスなどを定義。
*   **工程パターン定義:** ファイルごとに異なる可能性のあるデータ構造（特に各工程が使用する列数、関連する管内情報や分類情報など）をパターンとして定義し、処理対象ファイルごとにどのパターンを適用するかを指定。
*   **データ抽出オフセット:** 各工程ブロックの基準セルから見て、抽出したい各データ項目（工番、作業場所、作業内容、担当者、人数、作業員名など）がどの相対位置にあるかを「行,列」形式で指定。
*   **フィルター条件:** 抽出されたデータをさらに絞り込むための多様な条件（作業員名、管内、分類、工事種類、工番、作業種類、担当者名、人数、作業場所など）を指定。AND/OR検索、完全一致/部分一致検索などを組み合わせ可能。
*   **処理対象ファイルの指定:** データ抽出元となる工程表ファイルのフルパス、またはそれらが格納されているフォルダのパスをリスト形式で指定。
*   **出力オプション:** 抽出結果を書き出す際のヘッダー行の定義、既存データに対する処理（全クリアして上書き、または末尾に追記）などを指定。

## 👨‍💻 開発者向け情報

*   **VBAモジュール構成 (推奨):**
    *   `M00_GlobalDeclarations`: グローバルスコープの定数、Publicなユーザー定義型、グローバル変数の宣言。
    *   `M01_MainControl`: マクロ全体の実行フロー制御、初期化・終了処理の統括。
    *   `M02_ConfigReader`: 「Config」シートからの全設定情報の読み込みと検証。
    *   `M03_SheetManager`: 出力シートおよび各種ログシートの存在確認、自動生成、準備、表示制御。
    *   `M04_LogWriter`: エラーログおよび検索条件ログシートへの整形された情報の書き込み処理。
    *   `M05_FileProcessor`: 処理対象となる工程表ファイルのリストの特定と管理。
    *   `M06_DataExtractor`: 個々の工程表ファイルを開き、指定されたシートからデータを抽出し、フィルター条件を適用し、結果を出力シートに書き込むコアロジック。
    *   `(M_Utilities)`: (オプション) 複数のモジュールで共通して使用できる汎用的なヘルパー関数（配列の初期化状態チェック、文字列操作ユーティリティなど）を格納。
*   **主要なコーディング規約と原則:**
    *   全てのモジュールで `Option Explicit` を宣言し、変数宣言を強制します。
    *   変数名、定数名、プロシージャ名は、その役割が明確にわかる英語（または一般的に理解可能なローマ字の日本語名詞）で命名します。命名規則の詳細は `docs/07_Naming_Conventions_and_Glossary.md` を参照してください。
    *   VBA初心者が読んでも処理の意図と流れが理解できるように、極めて詳細かつ平易な日本語コメントを、モジュール、プロシージャ、変数宣言、主要な処理ブロック、ループ、条件分岐の全てに記述します。
    *   堅牢なエラーハンドリングを実装し、予期せぬエラー発生時にも可能な限り処理を継続し、詳細なログを残します。`On Error Resume Next` の使用は極力避け、構造化エラーハンドリング (`On Error GoTo Label`) を基本とします。
    *   レイトバインディング (`CreateObject`) を積極的に採用し、外部ライブラリへの事前参照設定を極力不要とすることで、異なる環境での動作互換性を高めます。
    *   1行If文 (`If ... Then ...`) や、コロン (`:`) による複数ステートメントの1行記述は禁止します。

## 🤝 貢献・バグ報告

*   バグの報告、機能改善の提案、その他フィードバックは、このGitHubリポジトリの **Issues** セクションを通じてお願いします。
*   コードの改善に貢献していただける場合は、**Pull Request** を歓迎します。事前にIssueで議論を開始することを推奨します。

## 📝 ライセンス
*   ライセンスなし

## バージョン
*   【ステップ1】プロジェクトの骨格とグローバル定義の確立
*   【ステップ2】ログ出力機能の基盤実装
*   【ステップ3】Configシート読み込み機能の基盤実装
*   【ステップ4】単一ファイルの指定と基本情報抽出 (工程パターン固定、フィルターなし)
*   【ステップ5】オフセットに基づくデータ項目抽出と「一覧」シートへの全件出力 (単一ファイル、工程パターン固定、フィルターなし)
*   【ステップ6】複数ファイル処理とファイルダイアログ対応
*   【ステップ7】工程パターン切り替え機能の実装
*   【ステップ8】各種フィルター機能の実装 (1つずつ段階的に)
*   【ステップ9】残りのConfig設定と最終調整
*   【ステップ10】ドキュメント整備と最終レビュー

---
