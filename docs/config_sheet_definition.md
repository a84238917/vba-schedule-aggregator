## Configシート定義 (Markdown表 - 更新版)

**シート名: `Config`**

| 代表セル範囲     | 項目名                                                              | 設定例 / 詳細説明 / 関連動作・備考                                                                                                                                                                                                                                                           |
| :------------- | :------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **A. 全般設定**   |                                                                      |                                                                                                                                                                                                                                                                                                |
| `O3`           | **A-1. デバッグモードフラグ**                                            | `TRUE` または `FALSE` (文字列、大文字小文字区別なし)。<br> - `TRUE`: イミディエイトウィンドウに詳細な処理ログ（ステップ、変数内容、警告、エラー等）を出力。<br> - `FALSE`: 通常運用モード。ログ出力を抑制。                                                                                                                  |
| `O12`          | **A-2. デフォルトフォルダパス**                                          | `C:\Users\YourName\Documents` など、有効なフォルダパス (文字列)。<br> - 「処理対象ファイル/フォルダパス」(`P557`-`P756`)が全て空の場合に表示されるファイル選択ダイアログの初期表示フォルダとして使用。                                                                                                                 |
| `O43`          | **A-3. 抽出結果出力シート名**                                          | `一覧データ` など (文字列)。<br> - この名前のシートに、フィルター処理後の抽出データがデータベース形式で出力されます。<br> - シートが存在しない場合は、マクロがヘッダー付きで自動生成します（ヘッダー定義は `O811`-`O821` を参照）。                                                                                                    |
| `O44`          | **A-4. 検索条件ログシート名**                                          | `処理ログ` など (文字列)。<br> - マクロ実行時の主要な設定値や適用されたフィルター条件を記録するシートです。<br> - シートが存在しない場合は、マクロが簡易ヘッダー付きで自動生成します。                                                                                                                            |
| `O45`          | **A-5. エラーログシート名**                                            | `エラー記録` など (文字列)。<br> - マクロ処理中に発生したエラーの詳細情報を記録するシートです。<br> - シートが存在しない場合は、マクロが簡易ヘッダー付きで自動生成します。                                                                                                                                   |
| `O46`          | **A-6. 設定ファイルシート名**                                          | `Config` (文字列)。<br> - このConfigシート自身の名前をマクロが認識するために使用します。マクロ内でこのシートを特定する際に参照されます。                                                                                                                                                             |
| `O122`         | **A-7. 工程パターンデータ取得方法** (`Work`シートからの再計算フラグ)      | `TRUE` または `FALSE` (文字列、大文字小文字区別なし)。<br> - `TRUE`: マクロが`O126`にパターン番号を設定後、`Application.Calculate`を実行し、Configシート上の数式(`J129:X列`)による`Work`シートからのデータ再計算を待ち、その結果を読み込む。<br> - `FALSE` (または`TRUE`以外): マクロがVBAロジックで直接`Work`シートを参照し、必要な工程パターンデータ（管内、分類、工程列数）を取得する（`O126`の値と`I列`のキー、`128行目`のシート名ヘッダーを使用）。 |
| **B. 工程表ファイル内 設定** |                                                                      |                                                                                                                                                                                                                                                                                                |
| `O66`-`O75`    | **B-1. 工程表内 検索対象シート名リスト**                               | `第1週`, `第2週`, ... (文字列、最大10個まで)。<br> - 各工程表ファイル内で、これらの名前を持つシートを順に処理対象とします。<br> - リスト内で空白のセルは無視されます。                                                                                                                                            |
| `O87`          | **B-2. 工程表ヘッダー行数**                                              | `3` など (数値)。<br> - 工程表シートのデータ本体が開始する行の、**直前まで**のヘッダー部分が占める行数を指定します。                                                                                                                                                                                |
| `O88`          | **B-3. 工程表ヘッダー列数**                                              | `1` など (数値)。<br> - 工程表シートのデータ本体が開始する列の、**左端から数えて何列目まで**がヘッダー部分か（または無視する列か）を指定します。例えばA列のみがヘッダー/無視列なら`1`。データ開始がB列ならこの値は`1`になります。                                                                                               |
| `O89`          | **B-4. 1日のデータが占める行数**                                         | `8` など (数値)。<br> - 工程表シート内で、1日分の情報（複数の工程ブロックを含む）が縦方向に何行で構成されているかを指定します。                                                                                                                                                                     |
| `O90`          | **B-5. 1シート内の最大日数**                                             | `7` など (数値)。<br> - 工程表ファイル内の1枚のシートが、最大何日分のデータを持っているかを指定します（例: 1週間分のシートなら7）。この日数分、縦方向にデータ取得を試みます。                                                                                                                                      |
| `O101`         | **B-6. 「年」のセルアドレス** (工程表シート内)                             | `FR2` など (文字列形式のセルアドレス)。<br> - 工程表シート内のこのセルから「年」の情報を取得します。                                                                                                                                                                                          |
| `O102`         | **B-7. 「月」のセルアドレス** (工程表シート内)                             | `GB2` など (文字列形式のセルアドレス)。<br> - 工程表シート内のこのセルから「月」の情報を取得します。                                                                                                                                                                                          |
| `O103`         | **B-8. 「日」の値がある列文字** (工程表シート内)                          | `A` など (文字列)。<br> - 工程表シート内のこの列から、各日の「日」の数値（例: 1, 2, ... 31）を取得します。                                                                                                                                                                           |
| `O104`         | **B-9. 「日」の値の行オフセット**                                        | `3` など (数値、1始まり)。<br> - その日のデータブロックの開始行から数えて、何行目に「日」の数値が記載されているかを指定します。                                                                                                                                                                       |
| `O114`         | **B-10. 1日の工程数**                                                   | `39` など (数値)。<br> - 工程表シート内で、1日あたり横方向にいくつの工程ブロック（作業単位）が繰り返されるかを指定します。この数だけ工程ループが実行されます。                                                                                                                                             |
| **C. 工程パターン定義** |                                                                      | (このセクションは、`O122`のフラグによってマクロの読み取り方法が分岐します)                                                                                                                                                                                                             |
| `O126`         | **C-1. 現在処理中ファイルに適用する工程パターン番号**                       | `1`, `2`, `パターンA` など (数値または文字列)。<br> - **このセルはマクロによって動的に書き換えられます。**マクロは処理対象ファイルのリスト(`P557`-`P756`)を処理する際、対応する`Q列`のパターン番号をこの`O126`セルに転記します。<br> - `O122`が`TRUE`の場合、このセルへの書き込み後、Excelの再計算を待ちます。                                                                                             |
| `I129` - `I(128 + O114の値)` | **C-2. 工程キーリスト** (工程パターンデータ取得用)               | `1`, `2`, `A-1` など (数値または文字列)。<br> - `O114`で指定された「1日の工程数」分の行数を使用します。<br> - `O122`が`FALSE`の場合、マクロが`Work`シートからデータを直接取得する際のキーとして、`O126`のパターン番号および`128行目`のシート名ヘッダーと共に使用されます。<br> - `O122`が`TRUE`の場合、Configシート上の数式がこの範囲を参照して`J列`以降のデータを更新します。                                     |
| `J129` - `J(128 + O114の値)` | **C-3. 管内1リスト** (O126のパターンに対応)                      | `大阪北`, `南拠点` など (文字列)。<br> - `O114`行数分。対応する工程の「管内1」として抽出され、フィルター条件(`O275`-`O294`)の対象となります。<br> - `O122`が`TRUE`なら数式結果、`FALSE`ならマクロが`Work`シートから取得した結果がここに表示される想定（マクロはこの値を直接読み取る）。空白の場合もそのまま処理。                                                                    |
| `K129` - `K(128 + O114の値)` | **C-4. 管内2リスト** (O126のパターンに対応)                      | `野江`, `ABCセンター` など (文字列)。<br> - `O114`行数分。対応する工程の「管内2」として抽出され、フィルター条件(`O305`-`O334`)の対象となります。<br> - `O122`が`TRUE`なら数式結果、`FALSE`ならマクロが`Work`シートから取得した結果がここに表示される想定。空白の場合もそのまま処理。                                                                          |
| `L129` - `L(128 + O114の値)` | **C-5. 分類1リスト** (O126のパターンに対応)                      | `制御`, `機械` など (文字列)。<br> - `O114`行数分。対応する工程の「分類1」として抽出され、フィルター条件(`O346`)の対象となります。<br> - `O122`が`TRUE`なら数式結果、`FALSE`ならマクロが`Work`シートから取得した結果がここに表示される想定。                                                                              |
| `M129` - `M(128 + O114の値)` | **C-6. 分類2リスト** (O126のパターンに対応)                      | `高圧`, `特別` など (文字列)。<br> - `O114`行数分。対応する工程の「分類2」として抽出され、フィルター条件(`O367`)の対象となります。<br> - `O122`が`TRUE`なら数式結果、`FALSE`ならマクロが`Work`シートから取得した結果がここに表示される想定。                                                                              |
| `N129` - `N(128 + O114の値)` | **C-7. 分類3リスト** (O126のパターンに対応)                      | `100`, `ABC` など (文字列または数値)。<br> - `O114`行数分。対応する工程の「分類3」として抽出され、フィルター条件(`O388`)の対象となります。<br> - `O122`が`TRUE`なら数式結果、`FALSE`ならマクロが`Work`シートから取得した結果がここに表示される想定。                                                                           |
| `O128`-`X128`                 | **C-8. 工程列数定義用シート名ヘッダー**                            | `第1週`, `第2週`, ..., `第5週`, (以降空白または追加のシート名で最大10個=X列まで)<br> - 工程表ファイル内の「検索対象シート名」(`O66`-`O75`)とこのヘッダー文字列が一致する列の値を、そのシートの工程列数として使用します。                                                                                  |
| `O129`-`X(128 + O114の値)`    | **C-9. 工程パターン別 工程列数定義**                               | `4`, `5` など (数値)。<br> - `O114`行数分。各行が1つの工程に対応し、各列(`O`～`X`)が`C-8`で定義されたシート名に対応します。<br> - ここで定義された数値が、その工程で抽出する作業員数の上限となります（最大10名）。<br> - 空白セルは0列として扱われます。<br> - `O122`が`TRUE`なら数式結果、`FALSE`ならマクロが`Work`シートから取得した結果がここに表示される想定。 |
| **D. フィルター条件** |                                                                      | (各フィルターリストはOR条件で検索。リストが空の場合はそのフィルターは適用されない)                                                                                                                                                               |
| `O242`         | **D-1. 作業員フィルター検索論理**                                      | `AND` または `OR` (文字列)。<br> - `AND`: `D-2`リスト内の全作業員が抽出データに含まれる場合に合致。<br> - `OR`: `D-2`リスト内のいずれかの作業員が抽出データに含まれる場合に合致。                                                                                                   |
| `O243`-`O262`  | **D-2. 作業員フィルターリスト**                                        | `山田太郎`, `佐藤花子`, ... (文字列、最大20名)。<br> - 空白セルは無視。抽出された作業員名と完全一致（大文字小文字区別なし）で比較。                                                                                                             |
| `O275`-`O294`  | **D-3. 管内1フィルターリスト**                                         | `大阪北`, `南大阪`, ... (文字列、最大20項目)。<br> - 空白セルは無視。抽出された管内1(`J列`の値)と完全一致（バイナリ比較）で比較。リスト内のいずれかに合致すればOK。                                                                                                 |
| `O305`-`O334`  | **D-4. 管内2フィルターリスト**                                         | `野江`, `小曽根`, ... (文字列、最大30項目)。<br> - 空白セルは無視。抽出された管内2(`K列`の値)と完全一致（バイナリ比較）で比較。リスト内のいずれかに合致すればOK。                                                                                                 |
| `O346`         | **D-5. 分類1フィルター**                                               | `制御`, `変電`など (文字列、複数指定時はカンマ区切り)。<br> - 空白は無視。抽出された分類1(`L列`の値)と部分一致（大文字小文字区別なし）で比較。カンマ区切りリスト内のいずれかに合致すればOK。                                                                                                |
| `O367`         | **D-6. 分類2フィルター**                                               | `高圧`, `特高`など (文字列、複数指定時はカンマ区切り)。<br> - 空白は無視。抽出された分類2(`M列`の値)と部分一致（大文字小文字区別なし）で比較。カンマ区切りリスト内のいずれかに合致すればOK。                                                                                                |
| `O388`         | **D-7. 分類3フィルター**                                               | `100`, `A-1`など (文字列、複数指定時はカンマ区切り)。<br> - 空白は無視。抽出された分類3(`N列`の値)と**完全一致**（大文字小文字区別なし）で比較。カンマ区切りリスト内のいずれかに合致すればOK。                                                                                             |
| `O409`-`O418`  | **D-8. 工事種類フィルターリスト**                                      | `自主`, `点検`, `自` ... (文字列、最大10項目)。<br> - 空白セルは無視。抽出された工事種類（オフセット`O784`で取得）と部分一致（大文字小文字区別なし）で比較。リスト内のいずれかに合致すればOK。                                                                                                      |
| `O431`-`O440`  | **D-9. 工番フィルターリスト**                                          | `X*`, `A-`, `*05` ... (文字列、最大10項目)。<br> - 空白セルは無視。抽出された工番（オフセット`O778`で取得）と部分一致（大文字小文字区別なし、ワイルドカード`*`は通常の文字として扱う）で比較。リスト内のいずれかに合致すればOK。                                                                                    |
| `O451`-`O470`  | **D-10. 作業種類フィルターリスト**                                     | `TrRy`, `TrPro`, ... (文字列、最大20項目)。<br> - 空白セルは無視。抽出された作業名1または作業名2（オフセット`O780`,`O781`で取得）のいずれかと部分一致（大文字小文字区別なし）で比較。リスト内のいずれかに合致すればOK。                                                                                         |
| `O481`-`O490`  | **D-11. 担当の名前フィルターリスト**                                   | `鈴木一郎`, `田中` ... (文字列、最大10項目)。<br> - 空白セルは無視。抽出された担当の名前（オフセット`O783`で取得）と部分一致（大文字小文字区別なし）で比較。リスト内のいずれかに合致すればOK。                                                                                                     |
| `O503`         | **D-12. 人数フィルター** (CSVでは`O503`だがMarkdown表では`O492`だった。CSVに合わせる) | `3` など (数値、1項目のみ)。<br> - 空白の場合は無視。抽出された人数（オフセット`O785`で取得）と完全一致で比較。                                                                                                                                                                      |
| `O514`         | **D-13. 作業箇所の種類フィルター** (CSVでは`O514`だがMarkdown表では`O503`だった。CSVに合わせる) | `変電所`, `開閉所`, `発電所` など (文字列、複数指定時はカンマ区切り)。<br> - 空白は無視。抽出された変電所名（作業箇所名、オフセット`O779`で取得）と部分一致（大文字小文字区別なし）で比較。カンマ区切りリスト内のいずれかに合致すればOK。                                                                     |
| `O525`-`O544`  | **D-14. 作業箇所フィルターリスト**                                     | `猪飼野`, `豊中`, ... (文字列、最大20項目)。<br> - 空白セルは無視。抽出された変電所名（作業箇所名、オフセット`O779`で取得）と部分一致（大文字小文字区別なし）で比較。リスト内のいずれかに合致すればOK。                                                                                                  |
| **E. 処理対象ファイル定義** |                                                                  |                                                                                                                                                                                                                                                                                                |
| `O557`-`O756`  | **E-1. (表示用)選択ファイル名** (マクロ処理には直接使用しない)           | `2025.04 月間予定表.xlsx` ... (文字列、最大200件)。<br> - この列はマクロの動作には直接関与しません。ユーザーの参照用です。                                                                                                                                                                   |
| `P557`-`P756`  | **E-2. 処理対象ファイル/フォルダパスリスト**                             | `C:\Koutei\April.xlsx`, `D:\KouteiData\` ... (文字列、最大200件)。<br> - 空白セルは無視。このリストに記載がある場合、それらを処理対象とします。フォルダ指定の場合は直下のExcelファイルが対象。<br> - このリストが全て空の場合、ファイル選択ダイアログが表示されます。                                                                                   |
| `Q557`-`Q756`  | **E-3. 各処理対象ファイル適用工程パターン**                              | `1`, `2`, `201204-201606`など (数値または文字列、最大200件)。<br> - `P列`の各ファイルパスに対応する工程パターン番号を指定します。<br> - マクロはこの`Q列`の値を読み取り、処理対象ファイルごとに`O126`セルに転記して使用します。空白の場合は、デフォルトのパターン（例: パターン1）を適用するか、エラーとするか要検討（ここではパターン1適用を推奨）。 |
| **F. 抽出データオフセット定義** |                                                              | (工程ブロックの基準セルからの相対位置。`行数,列数` 形式。0行0列は基準セル自身)                                                                                                                                                                                                            |
| `N778`-`N792`  | **F-1. オフセット項目名リスト** (最大15項目)                               | `工番`, `変電所`, `作業名1`, `作業名2`, (担当ラベルはここには不要か), `担当の名前`, `工事種類`, `人数`, `作業員`, `旧その他`, `終了時間`, `分類1抽出元`など。<br> - 出力順やフィルター対象との紐づけに使用。                                                                                               |
| `O778`-`O792`  | **F-2. オフセット値リスト** (`行,列`)                                      | `0,0`, `1,0`, ... (文字列)。<br> - `N列`の各項目名に対応するオフセット値を指定します。<br> - 「作業員」のオフセットは作業員1を指し、作業員2以降はマクロが列オフセットを自動で+1, +2...とします。抽出する作業員数は工程パターン(`C-9`)で決定（最大10名）。<br> - 空白または不正な書式の場合は、その項目の抽出をスキップまたはエラーログに記録。                                            |
| **G. 出力シート設定** |                                                                      |                                                                                                                                                                                                                                                                                                |
| `O811`         | **G-1. 出力シートヘッダー行数**                                          | `1` から `10` の範囲の数値。<br> - 「一覧」シートに作成するヘッダーの行数を指定します。                                                                                                                                                                                                         |
| `O812`-`O821`  | **G-2. 出力シートヘッダー内容**                                          | 例: `日付	管内1	工番	...	作業員1	作業員2	...	作業員10`<br> - 各セルに1行分のヘッダー文字列を入力します。タブ文字(`vbTab`)で列を区切ります。<br> - `G-1`で指定された行数分のヘッダーがここから使用されます。<br> - **作業員名は最大10名分**のヘッダー列を準備する想定。                                                                               |
| `O1124`        | **G-3. 出力データオプション**                                            | `リセット` または `引継ぎ` (文字列)。<br> - `リセット`: マクロ実行時に出力シートの既存データ（ヘッダー除く）をクリアしてから新規に書き出す。<br> - `引継ぎ`: 既存データの末尾に追記する。                                                                                                              |
| `O1126`        | **G-4. 非表示方式**                                                      | `xlSheetHidden` または `xlSheetVeryHidden` (文字列)。<br> - `G-5`で指定されたシートをマクロ終了時に非表示にする際の方式。                                                                                                                                                            |
| `O1127`-`O1146`| **G-5. マクロ実行後非表示シートリスト**                                  | `Config (1)`, `Work` ... (文字列、最大20シート)。<br> - 空白セルは無視。ここに記載された名前のシートをマクロ終了時に`G-4`で指定された方式で非表示にします。<br> - 存在しないシート名が指定されている場合はエラーログに記録し、無視します。                                                                                            |

---
1.  **`O122`が`TRUE`の場合:**
    *   ファイル処理ループの開始時（または各ファイル処理前）に、`P列`のファイルパスに対応する`Q列`のパターン文字列を`O126`セルにVBAで書き込む。
    *   `Application.Calculate`を実行する。
    *   （オプション）計算完了を待つための短い`DoEvents`または`Application.Wait`を挟む（数秒程度）。または、特定のキーセル（例：`J129`など、数式の結果が入る最初のセル）がエラー値でなくなるまで待つ、などの堅牢な待機処理。
    *   更新された`J129:X(128+工程数)`の値をVBAで読み取り、内部変数（構造体や配列）に格納して使用する。
2.  **`O122`が`FALSE`の場合:**
    *   `O126`セルへの書き込みや`Application.Calculate`は行わない。
    *   `P列`のファイルパスに対応する`Q列`のパターン文字列をVBA内で取得する。
    *   そのパターン文字列、`I列`の工程キーリスト、`128行目`のシート名ヘッダーを使用して、VBAのロジックで`Work`シートを直接検索・参照し、必要な管内情報、分類情報、および該当シートの工程列数を取得して内部変数に格納する。
